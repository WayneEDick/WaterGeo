# Script_02_001.yaml â€” Water Geo clean starter pipeline
# Update input path below to point at your PNG.

steps:
  - name: load_image
    args:
      path: input/input.png
    save: 01_gray.png

  - name: binarize_png
    args:
      method: otsu
      invert: false
      blur_ksize: 0
    save: 02_ink.png

  - name: segment_lines
    args:
      binary: ${binarize_png}
      eps_ink: 0
      min_valley_rows: 1
    save: 03_lines.json

  - name: extract_ccs
    args:
      binary: ${binarize_png}
      min_area: 5
    save: 04_ccs.json

  - name: estimate_baseline_and_xheight
    args: {}
    save: 05_metrics.json

  - name: merge_tokens_by_gap_baseline
    args: {}
    save: 06_tokens.json

  - name: identify_prose_runs_and_mask
    args:
      min_run_tokens: 5
    save: 07_prose_mask.json

  - name: pick_residual
    args: {}
    save: 08_residual.json

  - name: islandify
    args:
      pad: 1.0
    save: 09_islands.json

  - name: count_tokens
    args: {}
    save: 10_count.json
