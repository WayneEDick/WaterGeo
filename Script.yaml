meta:
  pipeline: WaterGeo
  version: v2.1-rails
  created: 2026-01-02
  notes:
  - 'Born-digital PNG: assume page-aligned (angle 0 or 90).'
  - Columns are derived; column boundaries (gutters) are detected as geometric obstacles.
  - Bad justification handled by persistence + crossings + two-rail test.
inputs:
  png_path: C:/Users/wayne/OneDrive/Documents/Jupyter/water/Geo/Code/input/input.png
  dpi: 300
  expected_polarity: auto
  approx_x_height_px: null
outputs:
  out_dir: out_geo
  save_debug_images: true
  save_json: true
  debug_upscale: 2
  debug_draw_cc_box_centers: true
  # Boxes-only view (blank background) is easiest to audit at G3.
  #  - 1.0 = solid filled rectangles
  #  - 0.3 = light fill
  #  - 0.0 = outlines only
  g3_boxes_only_fill_alpha: 1.0
params:
  cc:
    connectivity: 8
    min_area_px: 1
  g3:
    # Empirical pixel thresholds from G3_4.docx
    MaxChW: 95
    MaxChH: 85
    minChW: 4
    minChH: 11
  rails:
    eps_frac_min: 0.06
    eps_frac_max: 0.12
    min_support_abs: 10
    min_support_frac: 0.015
  lines:
    h_min_frac: 0.75
    h_max_frac: 1.6
    eps_line_mult: 0.5
  gutters:
    breuel_multiplier: 1.5
    gap_long_percentile: 0.85
    support_ratio_min: 0.35
    cross_rate_max: 0.2
    edge_peak_neighborhood_px: 6
    width_iqr_max_px: 12
steps:
- name: G0_load_normalize
  fn: load_normalize
  enabled: true
- name: G1_binarize
  fn: binarize
  enabled: true
- name: G2_connected_components
  fn: connected_components
  enabled: true
- name: G2b_build_ccs
  fn: build_ccs
  enabled: true
- name: G2c_debug_cc_boxes
  fn: debug_render_cc_boxes
  enabled: true

- name: G3_classify_ccs
  fn: classify_ccs_g3
  enabled: true

- name: G3b_debug_g3_boxes
  fn: debug_render_g3_boxes
  enabled: true

- name: G3c_debug_g3_boxes_only
  fn: debug_render_g3_boxes_only
  enabled: true
